#!/bin/bash -e

readonly EXTERNAL_DRIVE=/video-drive1/salsify-results
readonly INTERNAL_DRIVE=/video-drive1

if [[ -z $1 ]]; then
    echo "usage: $0 EXPERIMENT_DIR"
    exit -1
fi

readonly EXPERIMENT_VIDEO_NAME=$(basename $1)
readonly EXPERIMENT_VIDEO_PATH=$(readlink -e $(dirname $1))

readonly EXPERIMENT_DIR=$EXPERIMENT_VIDEO_PATH/$EXPERIMENT_VIDEO_NAME
if [[ -d $EXPERIMENT_DIR || -f $EXPERIMENT_DIR ]]; then
    echo "Experiment dir already exists!"
    exit -1
fi

readonly RESULTS_DIR=$(echo $EXPERIMENT_DIR | awk -F"salsify-results/benchmarks/"  '{print $2}') 
if [[ -z $RESULTS_DIR ]]; then
    echo "Experments must be in the salsify-results/benchmarks/ dir"
    exit -1
fi

echo "initializing: " $EXTERNAL_DRIVE/$RESULTS_DIR
mkdir -p $EXTERNAL_DRIVE/$RESULTS_DIR
mkdir -p $EXTERNAL_DRIVE/$RESULTS_DIR/capture-frames
mkdir -p $EXTERNAL_DRIVE/$RESULTS_DIR/playback-frames
touch $EXTERNAL_DRIVE/$RESULTS_DIR/$EXPERIMENT_VIDEO_NAME.capture.raw

echo "initializing: " $EXPERIMENT_DIR
mkdir $EXPERIMENT_DIR
ln -s $EXTERNAL_DRIVE/$RESULTS_DIR/capture-frames $EXPERIMENT_DIR
ln -s $EXTERNAL_DRIVE/$RESULTS_DIR/playback-frames $EXPERIMENT_DIR
ln -s $EXTERNAL_DRIVE/$RESULTS_DIR/$EXPERIMENT_VIDEO_NAME.capture.raw $EXPERIMENT_DIR
ln -s $EXPERIMENT_DIR/$EXPERIMENT_VIDEO_NAME.playback.raw $EXPERIMENT_DIR

